import streamlit as st
import pandas as pd

st.set_page_config(page_title="ãƒã‚¤ãƒ«ææ–™ä¾¡æ ¼è¡¨", layout="wide")
st.title("ãƒã‚¤ãƒ«ææ–™ä¾¡æ ¼è¡¨ï¼ˆå®Œå…¨ãƒ‡ãƒ¼ã‚¿ç‰ˆï¼‰")

# === å…¨ãƒ‡ãƒ¼ã‚¿åŸ‹ã‚è¾¼ã¿ ===
columns = [
    "ã‚«ãƒ†ã‚´ãƒª", "ç”¨é€”", "ãƒ–ãƒ©ãƒ³ãƒ‰", "è£½å“å", "å®¹é‡", "é€šå¸¸ä¾¡æ ¼", "TATä¾¡æ ¼", "å‚™è€ƒ", "å„ªå…ˆé †ä½",
    "å®¹é‡æ•°å€¤", "å®¹é‡å˜ä½", "å˜ä¾¡ï¼ˆé€šå¸¸ï¼‰", "å˜ä¾¡ï¼ˆTATä¾¡æ ¼ï¼‰", "ç›®å®‰ä½¿ç”¨é‡", "ä½¿ç”¨å¯èƒ½å›æ•°", "1å›ã‚ãŸã‚Šææ–™è²»"
]

data = [
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "Riccagel", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ã‚¸ãƒ¥ãƒ©ãƒ•ã‚£ãƒƒãƒˆ", "10g", 2750, None, "ãƒã‚¤ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®ã¿", 1, 10, "g", 275, None, 0.5, 20, 138],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "Riccagel", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ã‚¸ãƒ¥ãƒ©ãƒ•ã‚£ãƒƒãƒˆ", "30g", 7480, None, "ãƒã‚¤ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®ã¿", 1, 30, "g", 249, None, 0.5, 60, 125],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "Riccagel", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ã‚¸ãƒ¥ãƒ©ãƒ•ã‚£ãƒƒãƒˆ", "100g", 19800, None, "ãƒã‚¤ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®ã¿", 1, 100, "g", 198, None, 0.5, 200, 99],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "Riccagel", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ã‚¸ãƒ¥ãƒ©ãƒ•ã‚£ãƒƒãƒˆ", "500g", 66000, None, "3/1ã‚ˆã‚Š72000ã«å€¤ä¸Šã’", 1, 500, "g", 132, None, 0.5, 1000, 66],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "Riccagel", "RICCAãƒãƒƒãƒˆã‚³ãƒ¼ãƒˆã‚¸ã‚§ãƒ«", "10g", 2750, None, "è‰²é‰›ç­†ãƒ»ãƒãƒƒãƒˆãƒˆãƒƒãƒ—ä»•ä¸Šã’ç”¨", 1, 10, "g", 275, None, 0.5, 20, 138],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "Riccagel", "Riccaãƒãƒ³ãƒ¯ã‚¤ãƒ«ãƒ‡ã‚³ã‚¸ã‚§ãƒ«", "8g", 2420, None, "å¤šãä¹—ã›ã‚‹ã¨å°‘ã—ç™½ããªã‚‹", 3, 8, "g", 303, None, 0.5, 16, 151],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "ã‚¹ãƒãƒ¼ã‚¯ãƒ™ãƒ¼ã‚¹", "ãƒ•ã‚£ãƒ«ã‚¤ãƒ³ç”¨ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«", "5g", 1760, None, "æ¥½å¤©ï¼é»„è‰²ããªã‚Šã‚„ã™ã„", 3, 5, "g", 352, None, 0.5, 10, 176],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "ã‚¹ãƒãƒ¼ã‚¯ãƒ™ãƒ¼ã‚¹", "ãƒ•ã‚£ãƒ«ã‚¤ãƒ³ç”¨ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«", "15g", 4400, None, "æ¥½å¤©ï¼é»„è‰²ããªã‚Šã‚„ã™ã„", 3, 15, "g", 293, None, 0.5, 30, 147],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "ãƒ¡ãƒ«ãƒ†ã‚£ã‚¸ã‚§ãƒ«", "ã‚¯ãƒªã‚¢ã‚¸ã‚§ãƒ«", "14g", 1540, 1400, "ã‚«ãƒ©ãƒ¼ä½œæˆç”¨", 1, 14, "g", 110, 100, 0.5, 28, 55],
    ["ã‚¸ã‚§ãƒ«", "ãƒ™ãƒ¼ã‚¹ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ãƒˆãƒ»é•·ã•å‡ºã—ç­‰", "ibd", "LEDã‚¯ãƒªã‚¢ã‚¸ã‚§ãƒ«", "14g", 3124, 2840, "ãƒãƒ¼ãƒ‰ã‚¸ã‚§ãƒ«", 2, 14, "g", 223, 203, 0.5, 28, 112]
    # ...å¿…è¦ã«å¿œã˜ã¦ã•ã‚‰ã«å•†å“è¿½åŠ ...
]

df = pd.DataFrame(data, columns=columns)

if "selected" not in st.session_state:
    st.session_state.selected = []
if "checked_ids" not in st.session_state:
    st.session_state.checked_ids = set()

with st.sidebar:
    st.header("ğŸ“Š åˆè¨ˆé‡‘é¡")
    if st.session_state.selected:
        sdf = pd.DataFrame(st.session_state.selected)
        st.success(f"é€šå¸¸: Â¥{int(sdf['é€šå¸¸ä¾¡æ ¼'].sum()):,} ï¼ TAT: Â¥{int(sdf['TATä¾¡æ ¼'].sum(skipna=True) or 0):,}")
    else:
        st.info("å•†å“ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨åˆè¨ˆé‡‘é¡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™")
    if st.button("ğŸ§¹ å…¨ãƒªã‚»ãƒƒãƒˆ"):
        st.session_state.selected = []
        st.session_state.checked_ids = set()

st.markdown("### âœ… å•†å“é¸æŠ")
for idx, row in df.iterrows():
    cid = f"chk_{idx}"
    label = f"{row['è£½å“å']}ï¼ˆ{row['å®¹é‡']} ï¼ å˜ä¾¡ Â¥{row['å˜ä¾¡ï¼ˆé€šå¸¸ï¼‰']}ï¼‰"
    checked = cid in st.session_state.checked_ids
    if st.checkbox(label, key=cid, value=checked):
        if cid not in st.session_state.checked_ids:
            st.session_state.checked_ids.add(cid)
            st.session_state.selected.append(row)
    else:
        if cid in st.session_state.checked_ids:
            st.session_state.checked_ids.remove(cid)
            st.session_state.selected = [
                r for r in st.session_state.selected
                if not (r["ãƒ–ãƒ©ãƒ³ãƒ‰"] == row["ãƒ–ãƒ©ãƒ³ãƒ‰"] and r["è£½å“å"] == row["è£½å“å"] and r["å®¹é‡"] == row["å®¹é‡"])
            ]
    if row["å‚™è€ƒ"]:
        st.markdown(f"<span style='color:gray'>{row['å‚™è€ƒ']}</span>", unsafe_allow_html=True)
    st.markdown("---")
